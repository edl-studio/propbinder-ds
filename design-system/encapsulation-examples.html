<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encapsulation Examples: Emulated vs Shadow DOM</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .demo-box {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fafafa;
        }
        
        /* Global styles that will attempt to style components */
        .btn {
            background: red !important;
            color: white !important;
            padding: 20px !important;
            font-size: 24px !important;
            border: 5px solid yellow !important;
            border-radius: 20px !important;
        }
        
        .icon {
            color: purple !important;
            font-size: 50px !important;
        }
        
        /* Custom styles for testing inheritance */
        .parent-red {
            color: red;
            font-weight: bold;
        }
        
        .parent-large {
            font-size: 32px;
        }
        
        /* Testing CSS cascade */
        * {
            box-sizing: border-box;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        .highlight {
            background: yellow;
            padding: 2px;
        }
        
        .browser-note {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Encapsulation Comparison: Emulated vs Shadow DOM</h1>
        <p>This page demonstrates the practical differences between Angular's ViewEncapsulation strategies.</p>
        
        <div class="browser-note">
            <strong>Note:</strong> Open browser DevTools to inspect the DOM structure and see the differences in how styles are applied.
        </div>

        <!-- Example 1: Style Isolation -->
        <div class="section">
            <h2>1. Style Isolation Test</h2>
            <p>Global CSS tries to override component styles with <code>!important</code>:</p>
            <div class="demo-grid">
                <div class="demo-box">
                    <h4>Emulated Encapsulation</h4>
                    <div id="emulated-button"></div>
                    <p><small>Result: Global styles can still affect component if they use <code>!important</code> or have higher specificity</small></p>
                </div>
                <div class="demo-box">
                    <h4>Shadow DOM Encapsulation</h4>
                    <div id="shadow-button"></div>
                    <p><small>Result: Component styles are completely isolated from global styles</small></p>
                </div>
            </div>
        </div>

        <!-- Example 2: CSS Inheritance -->
        <div class="section">
            <h2>2. CSS Inheritance Test</h2>
            <p>Parent element has <code>color: red</code> and <code>font-weight: bold</code>:</p>
            <div class="demo-grid">
                <div class="demo-box parent-red">
                    <h4>Emulated Encapsulation</h4>
                    <div id="emulated-inherit"></div>
                    <p><small>Inheritable properties (color, font-weight) pass through</small></p>
                </div>
                <div class="demo-box parent-red">
                    <h4>Shadow DOM Encapsulation</h4>
                    <div id="shadow-inherit"></div>
                    <p><small>Inheritance is blocked by Shadow DOM boundary</small></p>
                </div>
            </div>
        </div>

        <!-- Example 3: Global Utility Classes -->
        <div class="section">
            <h2>3. Global Utility Classes Test</h2>
            <p>Testing if global utility classes can style component content:</p>
            <div class="demo-grid">
                <div class="demo-box">
                    <h4>Emulated Encapsulation</h4>
                    <div id="emulated-utilities"></div>
                    <p><small>Global utilities work when applied to component content</small></p>
                </div>
                <div class="demo-box">
                    <h4>Shadow DOM Encapsulation</h4>
                    <div id="shadow-utilities"></div>
                    <p><small>Global utilities are blocked by Shadow DOM</small></p>
                </div>
            </div>
        </div>

        <!-- Example 4: Third-party Library Integration -->
        <div class="section">
            <h2>4. Third-party Library Integration</h2>
            <p>Simulating a third-party widget that relies on global CSS:</p>
            <div class="demo-grid">
                <div class="demo-box">
                    <h4>Emulated Encapsulation</h4>
                    <div id="emulated-thirdparty"></div>
                    <p><small>Third-party styles work normally</small></p>
                </div>
                <div class="demo-box">
                    <h4>Shadow DOM Encapsulation</h4>
                    <div id="shadow-thirdparty"></div>
                    <p><small>Third-party styles are blocked</small></p>
                </div>
            </div>
        </div>

        <!-- Example 5: DevTools Inspection -->
        <div class="section">
            <h2>5. DevTools Inspection Differences</h2>
            <p>Open DevTools and inspect the elements below:</p>
            <div class="demo-grid">
                <div class="demo-box">
                    <h4>Emulated Encapsulation</h4>
                    <div id="emulated-inspect"></div>
                    <p><small>Look for: <code>_ngcontent-xxx</code> and <code>_nghost-xxx</code> attributes</small></p>
                </div>
                <div class="demo-box">
                    <h4>Shadow DOM Encapsulation</h4>
                    <div id="shadow-inspect"></div>
                    <p><small>Look for: <code>#shadow-root</code> boundary in DOM tree</small></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulated Angular Emulated Encapsulation
        class EmulatedButton extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                
                // Simulate emulated encapsulation with scoped attributes
                const uniqueId = 'c' + Math.random().toString(36).substr(2, 9);
                
                this.shadowRoot.innerHTML = `
                    <style>
                        /* Simulated emulated styles with attribute selectors */
                        .btn[${uniqueId}] {
                            background: #007bff;
                            color: white;
                            padding: 8px 16px;
                            border: 1px solid #007bff;
                            border-radius: 4px;
                            font-size: 14px;
                            cursor: pointer;
                        }
                        
                        .btn[${uniqueId}]:hover {
                            background: #0056b3;
                        }
                    </style>
                    <button class="btn" ${uniqueId}>Emulated Button</button>
                `;
            }
        }

        // True Shadow DOM Encapsulation
        class ShadowButton extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                
                this.shadowRoot.innerHTML = `
                    <style>
                        .btn {
                            background: #007bff;
                            color: white;
                            padding: 8px 16px;
                            border: 1px solid #007bff;
                            border-radius: 4px;
                            font-size: 14px;
                            cursor: pointer;
                        }
                        
                        .btn:hover {
                            background: #0056b3;
                        }
                    </style>
                    <button class="btn">Shadow DOM Button</button>
                `;
            }
        }

        // Inheritance test components
        class EmulatedInherit extends HTMLElement {
            constructor() {
                super();
                const uniqueId = 'c' + Math.random().toString(36).substr(2, 9);
                this.innerHTML = `
                    <style>
                        .text[${uniqueId}] {
                            border: 1px solid #ccc;
                            padding: 10px;
                            background: white;
                        }
                    </style>
                    <div class="text" ${uniqueId}>This text inherits parent styles</div>
                `;
            }
        }

        class ShadowInherit extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.shadowRoot.innerHTML = `
                    <style>
                        .text {
                            border: 1px solid #ccc;
                            padding: 10px;
                            background: white;
                            color: initial;
                            font-weight: initial;
                        }
                    </style>
                    <div class="text">This text is isolated from parent styles</div>
                `;
            }
        }

        // Utility classes test
        class EmulatedUtilities extends HTMLElement {
            constructor() {
                super();
                const uniqueId = 'c' + Math.random().toString(36).substr(2, 9);
                this.innerHTML = `
                    <div class="highlight" ${uniqueId}>
                        <span class="highlight">This uses global utility classes</span>
                    </div>
                `;
            }
        }

        class ShadowUtilities extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.shadowRoot.innerHTML = `
                    <style>
                        .container {
                            padding: 10px;
                            border: 1px solid #ccc;
                        }
                    </style>
                    <div class="container">
                        <span class="highlight">This tries to use global utility classes</span>
                    </div>
                `;
            }
        }

        // Third-party integration test
        class EmulatedThirdParty extends HTMLElement {
            constructor() {
                super();
                const uniqueId = 'c' + Math.random().toString(36).substr(2, 9);
                this.innerHTML = `
                    <div class="third-party-widget" ${uniqueId}>
                        <div class="widget-content">Third-party widget content</div>
                    </div>
                    <style>
                        .third-party-widget {
                            border: 2px solid #28a745;
                            padding: 10px;
                            background: #d4edda;
                        }
                        .widget-content {
                            font-weight: bold;
                        }
                    </style>
                `;
            }
        }

        class ShadowThirdParty extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.shadowRoot.innerHTML = `
                    <div class="third-party-widget">
                        <div class="widget-content">Third-party widget content</div>
                    </div>
                    <style>
                        /* Component needs to include all necessary styles */
                        .third-party-widget {
                            border: 2px solid #28a745;
                            padding: 10px;
                            background: #d4edda;
                        }
                        .widget-content {
                            font-weight: bold;
                        }
                    </style>
                `;
            }
        }

        // DevTools inspection examples
        class EmulatedInspect extends HTMLElement {
            constructor() {
                super();
                const uniqueId = 'c' + Math.random().toString(36).substr(2, 9);
                this.innerHTML = `
                    <div class="component" ${uniqueId}>
                        <p ${uniqueId}>Inspect this element - notice the scoped attributes</p>
                        <button class="btn" ${uniqueId}>Button with scoped styles</button>
                    </div>
                `;
            }
        }

        class ShadowInspect extends HTMLElement {
            constructor() {
                super();
                this.attachShadow({ mode: 'open' });
                this.shadowRoot.innerHTML = `
                    <style>
                        .component {
                            border: 1px solid #007bff;
                            padding: 10px;
                        }
                        .btn {
                            background: #007bff;
                            color: white;
                            border: none;
                            padding: 5px 10px;
                            border-radius: 3px;
                        }
                    </style>
                    <div class="component">
                        <p>Inspect this element - notice the #shadow-root boundary</p>
                        <button class="btn">Button inside Shadow DOM</button>
                    </div>
                `;
            }
        }

        // Register all custom elements
        customElements.define('emulated-button', EmulatedButton);
        customElements.define('shadow-button', ShadowButton);
        customElements.define('emulated-inherit', EmulatedInherit);
        customElements.define('shadow-inherit', ShadowInherit);
        customElements.define('emulated-utilities', EmulatedUtilities);
        customElements.define('shadow-utilities', ShadowUtilities);
        customElements.define('emulated-thirdparty', EmulatedThirdParty);
        customElements.define('shadow-thirdparty', ShadowThirdParty);
        customElements.define('emulated-inspect', EmulatedInspect);
        customElements.define('shadow-inspect', ShadowInspect);

        // Create component instances
        document.getElementById('emulated-button').appendChild(new EmulatedButton());
        document.getElementById('shadow-button').appendChild(new ShadowButton());
        document.getElementById('emulated-inherit').appendChild(new EmulatedInherit());
        document.getElementById('shadow-inherit').appendChild(new ShadowInherit());
        document.getElementById('emulated-utilities').appendChild(new EmulatedUtilities());
        document.getElementById('shadow-utilities').appendChild(new ShadowUtilities());
        document.getElementById('emulated-thirdparty').appendChild(new EmulatedThirdParty());
        document.getElementById('shadow-thirdparty').appendChild(new ShadowThirdParty());
        document.getElementById('emulated-inspect').appendChild(new EmulatedInspect());
        document.getElementById('shadow-inspect').appendChild(new ShadowInspect());

        // Add global styles that third-party libraries might use
        const globalThirdPartyStyles = `
            <style>
                .third-party-widget {
                    border: 3px solid red !important;
                    background: yellow !important;
                }
                .widget-content {
                    color: blue !important;
                    text-decoration: underline !important;
                }
            </style>
        `;
        document.head.insertAdjacentHTML('beforeend', globalThirdPartyStyles);
    </script>
</body>
</html>
